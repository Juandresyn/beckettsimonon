{% assign productMetafields = product.metafields.product %}
{% assign theCollection = '' %}

{% for coll in product.collections %}
  {% unless coll.title contains '[NOINDEX]' %}
    {% assign theCollection = coll.handle %}
  {% endunless %}
{% endfor %}

<script type="application/javascript">
  window.productMedia = {
    {% for block in section.blocks limit: section.blocks.size %}
      {% if theCollection == block.settings.collection %}
        '{{ block.settings.collection }}': {
          'video': '{{ block.settings.embed_video_id }}',
          'images': [
            {% if block.settings.image_1 %}"{{ block.settings.image_1 | img_url: 'master' }}",{% endif %}
            {% if block.settings.image_2 %}"{{ block.settings.image_2 | img_url: 'master' }}",{% endif %}
            {% if block.settings.image_3 %}"{{ block.settings.image_3 | img_url: 'master' }}",{% endif %}
            {% if block.settings.image_4 %}"{{ block.settings.image_4 | img_url: 'master' }}",{% endif %}
            {% if block.settings.image_5 %}"{{ block.settings.image_5 | img_url: 'master' }}"{% endif %}
          ]
        },
      {% endif %}
    {% endfor %}
  };
</script>

{% schema %}
{
  "name": "Product Media",
  "settings": [
    {
      "type": "header",
      "content": "Product Media Section"
    }
  ],
  "blocks": [
    {
      "type": "product_media",
      "name": "Media Slider Image",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Pick a Collection"
        },
        {
          "type": "text",
          "id": "embed_video_id",
          "label": "Embed Video ID"
        },
        {
          "type": "header",
          "content": "Image 1"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Pick an image."
        },
        {
          "type": "header",
          "content": "Image 2"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Pick an image."
        },
        {
          "type": "header",
          "content": "Image 3"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Pick an image."
        },
        {
          "type": "header",
          "content": "Image 4"
        },
        {
          "type": "image_picker",
          "id": "image_4",
          "label": "Pick an image."
        },
        {
          "type": "header",
          "content": "Image 5"
        },
        {
          "type": "image_picker",
          "id": "image_5",
          "label": "Pick an image."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Media",
      "category": "Layout"
    }
  ]
}
{% endschema %}
